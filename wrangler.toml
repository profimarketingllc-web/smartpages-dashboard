# ============================================================
# üåê SmartPages ‚Äì SmartCore Worker v9.4 INTERNAL BINDINGS
# ------------------------------------------------------------
# - Vollst√§ndiger Auth-Flow mit stabiler Cookie-Persistenz
# - Interne Service-Bindings f√ºr MAILER, CUSTOMER, BILLING
# - BILLING_TEST aktiv f√ºr Sandbox
# - Kompatibel mit D1-Datenbanken & KV-Stores (Cloudflare)
# ============================================================

name = "smartcore-worker"
main = "src/worker.js"
compatibility_date = "2024-12-20"
compatibility_flags = ["nodejs_compat"]

account_id = "595aede2251ad4bda349801970b7adcf"
workers_dev = true

[build]
command = "npm run build"
cwd = "."

# ============================================================
# üåç Production Environment
# ============================================================
[env.production]
name = "smartcore-worker"
main = "src/worker.js"

# ---------- D1 Datenbanken ----------
d1_databases = [
  { binding = "AUTH_DB", database_name = "smartpages_auth_eu", database_id = "afe58dd1-98d3-459c-8112-aeea65b53916" },
  { binding = "CORE_DB", database_name = "smartcore-db_eu", database_id = "f4c72bb3-9d56-4013-8404-47ad64808d5a" }
]

# ---------- KV Namespaces ----------
kv_namespaces = [
  { binding = "SESSION", id = "3ab700118c7d4b41bfefbc3cbeafe527" },
  { binding = "STAGING", id = "1b4dc7e1e5b54d059d1b493a3b4b6b9b" },
  { binding = "RLIMIT", id = "7b2ad16a49c34996a2bcadbe61e8e91e" }
]

# ---------- Interne Dienstbindungen ----------
[[env.production.services]]
binding = "CUSTOMER"
service = "smart-customer"
environment = "production"

[[env.production.services]]
binding = "MAILER"
service = "smartpages-mailer"
environment = "production"

[[env.production.services]]
binding = "BILLING"
service = "smart-billing"
environment = "production"

[[env.production.services]]
binding = "BILLING_TEST"
service = "smart-billing-test"
environment = "production"

# (Optional, f√ºr sp√§tere Erweiterung)
# [[env.production.services]]
# binding = "DOMAIN"
# service = "smart-domain"
# environment = "production"

# ---------- Globale Umgebungsvariablen ----------
[env.production.vars]
ENVIRONMENT = "production"
COOKIE_DOMAIN = ".smartpages.online"
FE_ORIGIN = "https://desk.smartpages.online"
PUBLIC_BASE_URL = "https://profi-marketing-llc.workers.dev"

# ============================================================
# üß™ Staging / Test Environment
# ============================================================
[env.staging]
name = "smartcore-worker-staging"
main = "src/worker.js"

[env.staging.vars]
ENVIRONMENT = "staging"
COOKIE_DOMAIN = ".smartpages.online"
FE_ORIGIN = "https://desk.smartpages.online"
PUBLIC_BASE_URL = "https://staging.smartpages.online"
