---
import "~/styles/global.css";
import ProductGrid from "~/components/core/ProductGrid.astro";

const products = [
  {
    title: "SmartProfile",
    label: "COMING SOON",
    text: "Your personal online profile that reflects your brand identity ‚Äî hosted securely in Europe, optimized for visibility, credibility, and full GDPR compliance across all digital channels.",
    gradient: "from-[#3D4CFF] to-[#6A5FFF]",
    glow: "hover:shadow-[0_0_30px_#3D4CFF80]",
  },
  {
    title: "SmartPage",
    label: "COMING SOON",
    text: "Build stunning, high-converting pages in minutes ‚Äî no coding required. Designed for creators, entrepreneurs, and small teams who want elegant design and full control without complexity.",
    gradient: "from-[#F5B400] to-[#E47E00]",
    glow: "hover:shadow-[0_0_30px_#F5B40080]",
  },
  {
    title: "SmartDomain",
    label: "COMING SOON",
    text: "Secure your domain, protect your brand, and stay GDPR-compliant from day one. SmartDomain makes managing your online identity effortless ‚Äî privacy-first and hosted in Europe.",
    gradient: "from-[#9D3DFF] to-[#6A3AFF]",
    glow: "hover:shadow-[0_0_30px_#9D3DFF80]",
  },
];
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartPages Login</title>
    <meta
      name="description"
      content="Login to SmartPages ‚Äî secure, privacy-first, and hosted in Europe."
    />
  </head>

  <body class="bg-white text-gray-800 font-inter pt-24 md:pt-28">
    <!-- Header -->
    <header
      class="bg-[#1E2A45] text-white py-5 px-4 flex flex-col md:flex-row items-center justify-center gap-4 shadow-lg fixed top-0 left-0 right-0 z-50"
    >
      <img
        src="/SmartPages_icon_transparent.png"
        alt="SmartPages Logo"
        class="w-20 h-20"
        loading="lazy"
      />
      <div class="text-center md:text-left">
        <h1 class="text-3xl font-extrabold">SmartPages</h1>
        <p class="text-sm md:text-base opacity-90">
          Go online in just 10 minutes ‚Äî privacy-first and GDPR compliant.
        </p>
      </div>
    </header>

    <!-- Hero + Login -->
    <section
      class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 px-6 mt-8 md:mt-10 mb-8 md:mb-10"
    >
      <!-- Left (Hero) -->
      <div class="bg-white shadow-xl p-8 rounded-2xl border border-gray-100">
        <h2 class="text-3xl font-extrabold text-[#F5B400] mb-6">
          Welcome to SmartPages
        </h2>

        <p class="mb-4">
          With <strong>SmartPages</strong>, you can build your professional online presence in just
          <strong>10 minutes</strong> ‚Äî without technical knowledge or complicated setup.
          Everything is hosted securely in <strong>Europe</strong> and fully compliant with
          <strong>GDPR</strong>.
        </p>

        <p class="mb-4">
          If your audience or clients are in the EU, GDPR compliance isn‚Äôt optional ‚Äî it‚Äôs required.
          SmartPages helps you meet these standards automatically, protecting your brand and your
          users‚Äô privacy from the very first click.
        </p>

        <p>
          Simply enter your contact details below, and we‚Äôll send you a personal
          <strong>Magic Link</strong> for secure instant access to your SmartPages dashboard ‚Äî
          no password, no tracking, no data collection.
        </p>
      </div>

      <!-- Right (Login Form) -->
      <div class="bg-[#f6f8fb] shadow-xl p-8 rounded-2xl border border-gray-100">
        <form id="magicForm" class="bg-white p-6 rounded-xl flex flex-col gap-4 shadow-sm">
          <div>
            <label class="block text-sm text-gray-600 mb-1">First Name *</label>
            <input type="text" name="first_name" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-[#F5B400]" />
          </div>

          <div>
            <label class="block text-sm text-gray-600 mb-1">Last Name</label>
            <input type="text" name="last_name" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-[#F5B400]" />
          </div>

          <div>
            <label class="block text-sm text-gray-600 mb-1">Email *</label>
            <input type="email" name="email" required class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-[#F5B400]" />
          </div>

          <div class="flex items-center gap-2">
            <input type="checkbox" id="is_business" name="is_business" />
            <label for="is_business" class="text-sm text-gray-600">This is a business account</label>
          </div>

          <div id="company_field" class="hidden">
            <label class="block text-sm text-gray-600 mb-1">Company Name</label>
            <input type="text" name="company_name" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-[#F5B400]" />
          </div>

          <button id="submitBtn" type="submit"
            class="bg-gradient-to-r from-[#F5B400] to-[#E47E00] text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-[0_0_20px_4px_rgba(245,180,0,0.6)] hover:scale-[1.04] transition-all duration-300 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed">
            Send Magic Link
          </button>
        </form>
      </div>
    </section>

    <!-- Product Cards -->
    <section class="mt-6 mb-12 px-4">
      <ProductGrid {products} />
    </section>

    <!-- Footer -->
    <footer class="text-center text-sm text-gray-600 py-6 bg-[#f5f5f5]">
      ¬© 2025 SmartPages ¬∑ Profi Marketing LLC ¬∑ Hosted in Europe ¬∑ GDPR compliant
    </footer>

    <!-- Popup -->
    <div id="popup" class="hidden fixed z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></div>

    <script>
      const API_URL = "https://api.smartpages.online/api/auth/start";
      const popup = document.getElementById("popup");
      const form = document.getElementById("magicForm");
      const submitBtn = document.getElementById("submitBtn");

      function showPopup(message, type = "success") {
        popup.innerHTML = message;
        popup.className =
          "fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-6 py-5 rounded-lg shadow-xl text-center text-base font-semibold z-50 bg-white border-l-8 " +
          (type === "success"
            ? "border-green-500 text-green-700"
            : type === "warning"
            ? "border-yellow-400 text-yellow-700"
            : "border-red-500 text-red-700");
        popup.classList.remove("hidden");
        setTimeout(() => popup.classList.add("hidden"), 7000);
      }

      form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
          first_name: form.first_name.value.trim(),
          last_name: form.last_name.value.trim(),
          email: form.email.value.trim(),
          company_name: form.company_name?.value.trim() || "",
          is_business: form.is_business.checked,
        };

        submitBtn.disabled = true;
        showPopup("‚è≥ Sending your Magic Link...<br><span class='text-sm opacity-80'>Please wait a moment.</span>", "warning");

        try {
          const res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
            mode: "cors",
          });
          const result = await res.json();

          if (result.ok) {
            showPopup("‚úÖ Magic Link sent! Please check your inbox.", "success");
          } else {
            switch (result.error) {
              case "invalid_email":
                showPopup("‚ùå Please enter a valid email address.", "error");
                break;
              case "email_bounced":
                showPopup("‚ö†Ô∏è Your email address could not be reached previously. Please check it and try again.", "error");
                break;
              case "trial_expired":
                showPopup("üí° Your free trial has expired. Please check your email for upgrade options.", "warning");
                break;
              case "rate_limited":
                showPopup("‚è≥ Please wait a few minutes before requesting another Magic Link.", "warning");
                break;
              case "mailer_unreachable":
                showPopup("üì≠ Our mail server is temporarily unavailable. Please try again later.", "error");
                break;
              case "mailer_error":
                showPopup("‚ùå There was an issue sending your email. Please try again.", "error");
                break;
              default:
                showPopup("‚ö†Ô∏è An unknown error occurred. Please review your details and try again.", "error");
            }
          }
        } catch {
          showPopup("‚ö†Ô∏è Network error. Please check your internet connection and try again.", "error");
        } finally {
          submitBtn.disabled = false;
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        const cb = document.getElementById("is_business");
        const field = document.getElementById("company_field");
        cb?.addEventListener("change", () => {
          field.classList.toggle("hidden", !cb.checked);
        });
      });
    </script>
  </body>
</html>
