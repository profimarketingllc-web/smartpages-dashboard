---
import PageLayout from "~/layouts/PageLayout.astro";
import "~/styles/global.css";
import CustomerCard from "@/components/core/CustomerCard.jsx";
import ImprintCard from "@/components/core/ImprintCard.jsx";
---

<PageLayout title="Dashboard â€“ SmartPages" sidebar={true} header={true}>
  <!-- ðŸŒ Dashboard Wrapper -->
  <div id="dashboard-wrapper" class="hidden fade-in">
    <CustomerCard client:load />
    <ImprintCard client:load />

    <!-- ðŸ§± Produkt-Kacheln -->
    <section
      class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-5 p-5 mt-6"
    >
      <a
        href="/de/smartprofile"
        class="rounded-2xl p-5 text-white bg-gradient-to-r from-[#4E6BFF] to-[#657AFF]
                shadow-[0_6px_16px_rgba(0,0,0,0.12)] transition-all duration-300
                hover:shadow-[0_0_25px_rgba(78,107,255,0.6)] hover:scale-[1.02]"
      >
        <h3 class="text-2xl font-bold mb-2">SmartProfile</h3>
        <p class="text-sm">
          Erstellen Sie Ihr professionelles Profil mit nur wenigen Klicks â€“ perfekt fÃ¼r Freelancer, Coaches und Unternehmer.
        </p>
      </a>

      <a
        href="/de/smartpage"
        class="rounded-2xl p-5 text-white bg-gradient-to-r from-[#F5B400] to-[#E47E00]
                shadow-[0_6px_16px_rgba(0,0,0,0.12)] transition-all duration-300
                hover:shadow-[0_0_25px_rgba(245,180,0,0.6)] hover:scale-[1.02]"
      >
        <h3 class="text-2xl font-bold mb-2">SmartPage</h3>
        <p class="text-sm">
          Erstellen Sie beeindruckende, conversion-optimierte Seiten â€“ einfach, schnell und professionell.
        </p>
      </a>

      <a
        href="/de/smartdomain"
        class="rounded-2xl p-5 text-white bg-gradient-to-r from-[#8B5CFF] to-[#A076FF]
                shadow-[0_6px_16px_rgba(0,0,0,0.12)] transition-all duration-300
                hover:shadow-[0_0_25px_rgba(139,92,255,0.6)] hover:scale-[1.02]"
      >
        <h3 class="text-2xl font-bold mb-2">SmartDomain</h3>
        <p class="text-sm">
          Sichern Sie Ihre eigene Domain direkt in SmartPages â€“ professionell, einfach und DSGVO-konform.
        </p>
      </a>
    </section>

    <!-- ðŸ’¬ Feedback-Karte -->
    <section
      class="max-w-6xl mx-auto mt-4 bg-[#f8f9fb] rounded-2xl p-5 text-center md:text-left shadow-md border border-gray-100 mb-8"
    >
      <div
        class="flex flex-col md:flex-row items-center justify-between gap-4"
      >
        <div>
          <h3 class="text-lg font-semibold text-gray-800 mb-1 md:mb-0">
            Ihr Feedback hilft uns, SmartPages zu verbessern
          </h3>
          <p class="text-sm text-gray-600">
            Teilen Sie Fehler, Ideen oder VorschlÃ¤ge â€“ helfen Sie uns, SmartPages noch besser zu machen.
          </p>
        </div>
        <a
          href="/de/feedback"
          class="inline-block px-6 py-3 bg-[#D9534F] text-white rounded-xl hover:bg-[#C0413B] 
                 transition-all duration-300 shadow-md whitespace-nowrap"
        >
          Feedback senden
        </a>
      </div>
    </section>
  </div>

  <!-- â³ Fallback â€žPrÃ¼fung lÃ¤uftâ€œ -->
  <div id="login-status" class="max-w-4xl mx-auto mt-20 text-center fade-in">
    <h2 class="text-2xl font-bold text-[#1E2A45]">Anmeldung wird geprÃ¼ft...</h2>
  </div>

  <!-- âš™ï¸ Deutscher Footer -->
  <footer
    class="w-full text-center text-gray-600 py-6 border-t border-gray-200 text-sm bg-gray-50"
  >
    Â© 2026 SmartPages Â· Gehostet in Europa Â· DSGVO-konform
  </footer>
</PageLayout>

<!-- ðŸ§  Script: Authentifizierung + Animation -->
<script>
window.addEventListener("DOMContentLoaded", async () => {
  try {
    const res = await fetch("https://api.smartpages.online/api/session", {
      method: "GET",
      credentials: "include",
      headers: { Accept: "application/json" },
    });
    const data = await res.json();

    // Wenn der User eingeloggt ist â†’ Dashboard anzeigen
    if (data.ok && data.authenticated) {
      document.getElementById("login-status")?.classList.add("hidden");
      document.getElementById("dashboard-wrapper")?.classList.remove("hidden");
    } else {
      // Nach kurzer Zeit zur "Abgemeldet"-Ansicht wechseln
      setTimeout(() => {
        document.getElementById("login-status").innerHTML =
          '<h2 class="text-2xl font-bold text-[#1E2A45]">Nicht angemeldet</h2>';
      }, 2000);
    }
  } catch (e) {
    console.error("Session fetch failed:", e);
  }
});
</script>

<style>
.fade-in {
  animation: fadeIn 0.8s ease-in-out;
}
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
</style>
