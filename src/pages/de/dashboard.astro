---
import PageLayout from "~/layouts/PageLayout.astro";
import CustomerCard from "@/components/core/CustomerCard.jsx";
import ImprintCard from "@/components/core/ImprintCard.jsx";
---

<PageLayout title="Dashboard â€“ SmartPages" sidebar={true} header={true}>
  <div id="dashboard-wrapper" class="relative space-y-6">

    <!-- ðŸ•“ Pop-up Statusanzeige -->
    <div
      id="login-status"
      class="absolute left-1/2 transform -translate-x-1/2 top-10
             bg-[#E47E7E] text-white text-base font-semibold px-6 py-3
             rounded-2xl shadow-lg opacity-0 pointer-events-none transition-opacity duration-700 z-50"
    >
      PrÃ¼fe Anmeldung...
    </div>

    <!-- ðŸ§© Solid-Komponenten -->
    <CustomerCard client:only="solid-js" />
    <ImprintCard client:only="solid-js" />

    <!-- ðŸ§± Produkt-Bereich -->
    <section class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-5 p-5 mt-4">
      <a href="/de/smartprofile" 
         class="rounded-2xl p-5 text-white bg-gradient-to-r from-[#4E6BFF] to-[#657AFF]
                shadow-[0_6px_16px_rgba(0,0,0,0.12)] transition-all duration-300
                hover:shadow-[0_0_25px_rgba(78,107,255,0.6)] hover:scale-[1.02]">
        <h3 class="text-2xl font-bold mb-2">SmartProfile</h3>
        <p class="text-sm">
          Erstelle Dein professionelles Profil mit nur wenigen Klicks â€“ perfekt fÃ¼r Freelancer, Coaches und Unternehmer.
        </p>
      </a>

      <a href="/de/smartpage" 
         class="rounded-2xl p-5 text-white bg-gradient-to-r from-[#F5B400] to-[#E47E00]
                shadow-[0_6px_16px_rgba(0,0,0,0.12)] transition-all duration-300
                hover:shadow-[0_0_25px_rgba(245,180,0,0.6)] hover:scale-[1.02]">
        <h3 class="text-2xl font-bold mb-2">SmartPage</h3>
        <p class="text-sm">
          Erstelle beeindruckende, konversionsoptimierte Seiten in Minuten â€“ einfach, schnell und professionell.
        </p>
      </a>

      <a href="/de/smartdomain" 
         class="rounded-2xl p-5 text-white bg-gradient-to-r from-[#8B5CFF] to-[#A076FF]
                shadow-[0_6px_16px_rgba(0,0,0,0.12)] transition-all duration-300
                hover:shadow-[0_0_25px_rgba(139,92,255,0.6)] hover:scale-[1.02]">
        <h3 class="text-2xl font-bold mb-2">SmartDomain</h3>
        <p class="text-sm">
          Sichere Dir Deine eigene Domain direkt in SmartPages â€“ professionell, einfach und DSGVO-konform.
        </p>
      </a>
    </section>

    <!-- ðŸ’¬ Feedback -->
    <section class="max-w-6xl mx-auto mt-4 bg-[#f8f9fb] rounded-2xl p-5 text-center md:text-left shadow-md border border-gray-100 mb-8">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div>
          <h3 class="text-lg font-semibold text-gray-800 mb-1 md:mb-0">
            Dein Feedback hilft uns, besser zu werden
          </h3>
          <p class="text-sm text-gray-600">
            Teile Fehler, Ideen oder VorschlÃ¤ge â€“ hilf uns, SmartPages noch besser zu machen.
          </p>
        </div>
        <a
          href="/de/feedback"
          class="inline-block px-6 py-3 bg-[#D9534F] text-white rounded-xl hover:bg-[#C0413B] 
                 transition-all duration-300 shadow-md whitespace-nowrap"
        >
          Feedback senden
        </a>
      </div>
    </section>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      const statusEl = document.getElementById("login-status");
      if (!statusEl) return;

      // Zeige Popup (sanft)
      setTimeout(() => {
        statusEl.classList.add("opacity-100");
      }, 200);

      try {
        const res = await fetch("https://api.smartpages.online/api/session", {
          method: "GET",
          credentials: "include",
          headers: { "Accept": "application/json" },
        });
        const data = await res.json();

        if (data.ok && data.authenticated) {
          // Erfolgreiche Anmeldung: sofort ausblenden
          setTimeout(() => {
            statusEl.classList.remove("opacity-100");
          }, 1000);
        } else {
          // Kein Token -> nach 2 Sekunden ausblenden
          setTimeout(() => {
            statusEl.classList.remove("opacity-100");
          }, 2000);
        }
      } catch (e) {
        console.error("Session fetch failed:", e);
        setTimeout(() => {
          statusEl.classList.remove("opacity-100");
        }, 2000);
      }
    });
  </script>

  <style>
    /* Einheitliches Placeholder-Design */
    .placeholder {
      background-color: rgb(209 213 219); /* Tailwind gray-300 */
      border-radius: 0.5rem;
      padding: 0.25rem 0.75rem;
      color: transparent;
      user-select: none;
      display: inline-block;
      min-width: 5rem;
    }

    footer {
      text-align: center;
      font-size: 0.875rem;
      color: #6b7280;
      padding: 1rem 0;
      border-top: 1px solid #e5e7eb;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(6px);
    }
    footer::before {
      content: "Â© 2026 SmartPages Â· Gehostet in Europa Â· DSGVO-konform";
    }
  </style>
</PageLayout>
