---
/**
 * ProductGrid.astro â€“ FINAL (Static + Auth-aware)
 * -----------------------------------------------
 * âœ” Design unverÃ¤ndert
 * âœ” Funktioniert fÃ¼r Login, Public & Dashboard
 * âœ” Product-Fencing vorbereitet
 * âœ” Keine Server-AbhÃ¤ngigkeit
 */

import ProductCard from "./ProductCard.astro";

const {
  lang = "de",
  upsell = null, // Dashboard-Upsell (optional)
} = Astro.props;

/* -------------------------------------------------- */
/* Fallback-Texte (Public / Login)                    */
/* -------------------------------------------------- */
const teaser = {
  de: {
    smartprofile: "Dein professionelles Online-Profil â€“ sicher, sichtbar und DSGVO-konform.",
    smartpage: "Conversion-starke Seiten in Minuten â€“ ganz ohne Programmierung.",
    smartdomain: "Eigene Domain, SSL & Datenschutz â€“ alles aus einer Hand.",
    smartlinks: "Datenschutzfreundliche Kurzlinks mit Analyse-Fokus.",
  },
  en: {
    smartprofile: "Your professional online profile â€“ secure, visible and GDPR-compliant.",
    smartpage: "High-converting pages in minutes â€“ no coding required.",
    smartdomain: "Own domain, SSL & privacy â€“ all in one.",
    smartlinks: "Privacy-friendly short links with analytics focus.",
  },
};

const t = teaser[lang] ?? teaser.de;

/* -------------------------------------------------- */
/* Content-AuflÃ¶sung                                  */
/* -------------------------------------------------- */
const content = {
  smartprofile: upsell?.smartprofile ?? {
    title: "SmartProfile",
    text: t.smartprofile,
  },
  smartpage: upsell?.smartpage ?? {
    title: "SmartPage",
    text: t.smartpage,
  },
  smartdomain: upsell?.smartdomain ?? {
    title: "SmartDomain",
    text: t.smartdomain,
  },
  smartlinks: upsell?.smartlinks ?? {
    title: "SmartLinks",
    text: t.smartlinks,
  },
};
---

<section
  class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 px-4 py-6"
  id="product-grid"
>
  <ProductCard
    title={content.smartprofile.title}
    text={content.smartprofile.text}
    gradient="from-[#4E6BFF] to-[#657AFF]"
    glow="hover:shadow-[0_0_30px_#4E6BFF80]"
    action="/features/smartprofile"
    data-product="smartprofile"
  />

  <ProductCard
    title={content.smartpage.title}
    text={content.smartpage.text}
    gradient="from-[#F5B400] to-[#E47E00]"
    glow="hover:shadow-[0_0_30px_#F5B40080]"
    action="/features/smartpage"
    data-product="smartpage"
  />

  <ProductCard
    title={content.smartdomain.title}
    text={content.smartdomain.text}
    gradient="from-[#8B5CFF] to-[#A076FF]"
    glow="hover:shadow-[0_0_30px_#8B5CFF80]"
    action="/features/smartdomain"
    data-product="smartdomain"
  />

  <ProductCard
    title={content.smartlinks.title}
    text={content.smartlinks.text}
    gradient="from-[#A8D5BA] to-[#7FBF9A]"
    glow="hover:shadow-[0_0_30px_#A8D5BA80]"
    action="/features/smartlinks"
    data-product="smartlinks"
  />
</section>

<!-- ðŸ” Product Fencing (Client-only, non-blocking) -->
<script>
  (function () {
    const user = window.SMARTPAGES_USER;
    if (!user || !Array.isArray(user.active_products)) return;

    const active = user.active_products;
    const cards = document.querySelectorAll("[data-product]");

    cards.forEach((card) => {
      const product = card.getAttribute("data-product");
      if (!product) return;

      if (active.includes(product)) {
        card.classList.add("opacity-70", "pointer-events-none");
        const badge = document.createElement("div");
        badge.textContent = "Aktiv";
        badge.className =
          "absolute top-3 right-3 text-xs font-semibold bg-green-600 text-white px-2 py-1 rounded-full";
        card.style.position = "relative";
        card.appendChild(badge);
      }
    });
  })();
</script>
