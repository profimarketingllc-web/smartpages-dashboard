/**
 * ProductGrid.astro â€“ STABLE VERSION
 * -----------------------------------------------------
 * âœ… Design bleibt unverÃ¤ndert
 * âœ… Dashboard & Login funktionieren identisch
 * âœ… Ganze Kachel klickbar
 */

import ProductCard from "./ProductCard.astro";

// Sprache
const currentPath = Astro.url.pathname.toLowerCase();
const detectedLang = currentPath.includes("/en") ? "en" : "de";

// Props
const {
  products = null,
  lang = detectedLang,
  compact = false,
} = Astro.props;

/* ------------------------------------------------------------------ */
/* ðŸŽ¨ ZENTRALE DESIGN-DEFINITION (einmalig)                           */
/* ------------------------------------------------------------------ */
const designMap = {
  smartprofile: {
    gradient: "from-[#4E6BFF] to-[#657AFF]",
    glow: "hover:shadow-[0_0_30px_#4E6BFF80]",
    defaultAction: "/features/smartprofile",
  },
  smartpage: {
    gradient: "from-[#F5B400] to-[#E47E00]",
    glow: "hover:shadow-[0_0_30px_#F5B40080]",
    defaultAction: "/features/smartpage",
  },
  smartdomain: {
    gradient: "from-[#8B5CFF] to-[#A076FF]",
    glow: "hover:shadow-[0_0_30px_#8B5CFF80]",
    defaultAction: "/features/smartdomain",
  },
};

/* ------------------------------------------------------------------ */
/* ðŸ§  Daten normalisieren                                              */
/* ------------------------------------------------------------------ */
const items = (products || []).map((p) => {
  const key = p.key?.toLowerCase() || p.title?.toLowerCase();

  const design = designMap[key] || {};

  return {
    ...p,
    label: p.label || "UPGRADE",
    gradient: p.gradient || design.gradient,
    glow: p.glow || design.glow,
    action: p.action || design.defaultAction,
  };
});
---

<section
  class={`${
    compact
      ? "w-full mx-auto grid grid-cols-1 md:grid-cols-3 gap-5"
      : "max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6 px-4 md:px-6 py-4 md:py-5"
  }`}
>
  {items.map((p) => (
    <a
      href={p.action}
      class="block w-full h-full focus:outline-none"
      aria-label={p.title}
    >
      <ProductCard
        title={p.title}
        label={p.label}
        text={p.text}
        gradient={p.gradient}
        glow={p.glow}
        action={p.action}
      />
    </a>
  ))}
</section>
