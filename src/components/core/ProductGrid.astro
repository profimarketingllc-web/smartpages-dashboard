---
/**
 * ProductGrid.astro (Smart Adaptive Edition)
 * ------------------------------------------
 * - Erkennt automatisch Umgebung (DashboardCardWide vs. Login)
 * - Passt Padding, Margin und Layout automatisch an
 * - Ideal f√ºr Teaser auf Login-Seiten & Upsells im Dashboard
 */

import ProductCard from "./ProductCard.astro";

// Aktuelle URL analysieren
const currentPath = Astro.url.pathname.toLowerCase();

// Automatische Variante bestimmen
let detectedVariant = "teaser";
if (currentPath.includes("/dashboard")) detectedVariant = "upsell";
else if (currentPath.includes("/login") || currentPath.includes("/signin")) detectedVariant = "teaser";

// Props (manuelle Variante √ºberschreibt Automatik)
const {
  products = [],
  variant = detectedVariant,
} = Astro.props;

// Inhalte je nach Variante
const productSets = {
  teaser: [
    {
      title: "SmartProfile",
      label: "Neu üöÄ",
      text: "Erstelle Dein professionelles Profil mit nur wenigen Klicks ‚Äì perfekt f√ºr Freelancer, Coaches und Unternehmer.",
      gradient: "from-[#4E6BFF] to-[#657AFF]",
      glow: "hover:shadow-[0_0_30px_#4E6BFF80]",
      action: "/register",
    },
    {
      title: "SmartPage",
      label: "",
      text: "Erstelle beeindruckende, konversionsoptimierte Seiten in Minuten ‚Äì einfach, schnell und professionell.",
      gradient: "from-[#F5B400] to-[#E47E00]",
      glow: "hover:shadow-[0_0_30px_#F5B40080]",
      action: "/register",
    },
    {
      title: "SmartDomain",
      label: "",
      text: "Sichere Dir Deine eigene Domain direkt in SmartPages ‚Äì professionell, einfach und DSGVO-konform.",
      gradient: "from-[#8B5CFF] to-[#A076FF]",
      glow: "hover:shadow-[0_0_30px_#8B5CFF80]",
      action: "/register",
    },
  ],
  upsell: [
    {
      title: "SmartProfile",
      label: "",
      text: "Schalte Premium-Funktionen f√ºr Dein Profil frei ‚Äì mehr Reichweite, Branding und Automatisierung.",
      gradient: "from-[#4E6BFF] to-[#657AFF]",
      glow: "hover:shadow-[0_0_30px_#4E6BFF80]",
      action: "/paywall?product=profile",
    },
    {
      title: "SmartPage",
      label: "",
      text: "Erstelle unbegrenzt Seiten mit erweiterten Templates, KI-Texten und Conversion-Boostern.",
      gradient: "from-[#F5B400] to-[#E47E00]",
      glow: "hover:shadow-[0_0_30px_#F5B40080]",
      action: "/paywall?product=page",
    },
    {
      title: "SmartDomain",
      label: "",
      text: "Profitiere von eigener Domain & SSL-Zertifikat f√ºr Dein SmartPages-Setup.",
      gradient: "from-[#8B5CFF] to-[#A076FF]",
      glow: "hover:shadow-[0_0_30px_#8B5CFF80]",
      action: "/paywall?product=domain",
    },
  ],
};

// Fallback: Props > Automatik > Default
const items = products.length ? products : productSets[variant];

// Dynamisch Layout bestimmen anhand der Umgebung
// (DashboardCards haben meist einen parent mit 'rounded-3xl' oder 'border-gray-100')
let isInDashboardCard = false;
if (Astro.slots && Astro.locals?.componentMetadata) {
  // heuristische Pr√ºfung: bei eingebetteter Komponente in DashboardCardWide
  isInDashboardCard = true;
} else if (currentPath.includes("/dashboard")) {
  isInDashboardCard = true;
}
---

<section
  class={`w-full flex justify-center ${
    isInDashboardCard ? "my-1" : "my-10"
  }`}
>
  <div
    class={`max-w-6xl w-full grid grid-cols-1 md:grid-cols-3 gap-6 
      ${isInDashboardCard ? "px-2 sm:px-3 py-2 md:py-3" : "px-6 sm:px-10 py-8 md:py-10"}
      place-items-center`}
  >
    {items.map((p) => (
      <ProductCard
        title={p.title}
        label={p.label}
        text={p.text}
        gradient={p.gradient}
        glow={p.glow}
        action={p.action}
      />
    ))}
  </div>
</section>

<style>
  section {
    transition: all 0.25s ease-in-out;
  }

  /* Kompaktes Layout f√ºr mobile Ger√§te */
  @media (max-width: 768px) {
    div {
      gap: 1.25rem;
      padding: 0.75rem 0.5rem !important;
    }
  }
</style>
