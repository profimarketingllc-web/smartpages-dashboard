---
import "~/styles/global.css";
import SmartHeader from "~/components/shared/SmartHeader.astro";
import SmartSidebar from "~/components/shared/SmartSidebar.astro";

const {
  sidebar = true,
  header = true,
} = Astro.props;
---

<div class="min-h-screen flex font-sans bg-[#F7F8FA] text-smart-text">
  {sidebar && <SmartSidebar />}

  <div class={`flex-1 flex flex-col ${sidebar ? "md:ml-64" : ""}`}>
    {header && <SmartHeader />}

    <main class="flex-1 px-4 py-4 max-w-[1500px] w-full mx-auto">
      <slot />
    </main>

    <footer class="text-center text-sm text-gray-500 py-4 border-t bg-white/80">
      Â© SmartPages
    </footer>
  </div>
</div>

<!-- ðŸ” LANGUAGE BOOTSTRAP (CLIENT ONLY, SESSION BASED) -->
<script>
  (async function bootstrapLang() {
    try {
      const res = await fetch("/api/session/userinfo", {
        credentials: "include",
      });

      const data = await res.json();

      if (data?.ok && data.user?.language) {
        window.SMARTPAGES_LANG = data.user.language;
      } else {
        // âœ… HARTE, EINDEUTIGE FALLBACK-SPRACHE
        window.SMARTPAGES_LANG = "en";
      }
    } catch (e) {
      window.SMARTPAGES_LANG = "en";
    }

    // ðŸ”” Optional: Event fÃ¼r Komponenten
    window.dispatchEvent(new Event("smartpages:lang-ready"));
  })();
</script>
